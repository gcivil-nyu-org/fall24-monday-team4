{% extends "base.html" %}

{% block title%}Home{% endblock %}

{% block content %}
{% if user.is_authenticated %}
<p>Hi {{ user.username }}! Welcome to Route Pals.</p>

<!-- Show map with user's current location if logged in -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<style>
    #map {
        height: 500px;
        width: 100%;
    }
</style>
 <div id="map"></div>
<script>
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;

            // Initialize the map and set its view to the user's location
            const map = L.map('map').setView([latitude, longitude], 13);

            // Add OpenStreetMap tiles
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: 'Â© OpenStreetMap'
            }).addTo(map);

            // Add a marker for the user's location
            L.marker([latitude, longitude]).addTo(map)
                .bindPopup('You are here!')
                .openPopup();
        }, function() {
            alert('Unable to retrieve your location.');
        });
    } else {
        alert('Geolocation is not supported by this browser.');
    }
</script>
{% else %}
<p>Welcome to Route Pals.</p>
<p><a class="btn btn-secondary btn-lg" href="/accounts/signup" role="button">Sign Up</a></p>
<a class="btn btn-primary btn-lg" href="{% url 'login' %}" role="button">Log In</a>
{% endif %}
{% endblock %}